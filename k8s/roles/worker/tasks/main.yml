---
# tasks file for worker
- name: Join Cluster
  block:
    - name: Ensure /tmp/k8s directory exists on worker
      file:
        path: /tmp/k8s
        state: directory
        mode: '0755'

    - name: Copy join command from localhost to worker
      copy:
        src: /tmp/k8s/join_command.sh
        dest: /tmp/k8s/join_command.sh
        mode: '0755'

    - name: Ensure correct shebang line
      lineinfile:
        path: /tmp/k8s/join_command.sh
        line: "#!/bin/sh"
        insertafter: BOF

    - name: Execute join command on worker
      command: /tmp/k8s/join_command.sh
      register: worker_output

    - name: Debug Complete Output
      debug:
      msg: "{{ worker_output.stdout_lines }}"